<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../assets/css/layui.css">
    <link rel="stylesheet" href="../assets/css/view.css"/>
    <link rel="icon" href="/favicon.ico">
    <title>学生在线小测系统-个人资料</title>
    <style>
        #studentTel,#studentEmail{
          width: 300px;
        }
        .labelMessage{
          position: relative;
          top: 9px;
        }
    </style>
</head>
<body class="layui-view-body">
    <div class="layui-content">
        <div class="layui-page-header">
            <div class="pagewrap">
                <span class="layui-breadcrumb">
                  <a><cite>首页</cite></a>
                  <a><cite>用户</cite></a>
                  <a><cite>个人资料</cite></a>
                </span>
                <h2 class="title">个人资料</h2>
            </div>
        </div>
        <div class="layui-row">
            <div class="layui-card">
                <form class="layui-form" action="post">
                    <div class="layui-form-item">
                        <label class="layui-form-label">学院：</label>
                        <label id="collegeName" class="labelMessage"></label>
                    </div>
                    <div class="layui-form-item">
                      <label class="layui-form-label">专业：</label>
                      <label id="clazzName" class="labelMessage"></label>
                    </div>
                    <div class="layui-form-item">
                      <label class="layui-form-label">班级：</label>
                      <label id="clazzNumber" class="labelMessage"></label>
                    </div>
                    <div class="layui-form-item">
                      <label class="layui-form-label">学号：</label>
                      <label id="studentNumber" class="labelMessage"></label>
                    </div>
                    <div class="layui-form-item">
                      <label class="layui-form-label">姓名：</label>
                      <label id="studentName" class="labelMessage"></label>
                    </div>
                    <div class="layui-form-item">
                      <label class="layui-form-label">性别：</label>
                      <label id="studentSex" class="labelMessage"></label>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">手机号码</label>
                        <div class="layui-input-block">
                          <input type="tel" id="studentTel" placeholder="请输入手机号码" lay-verify="required|phone" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">邮箱</label>
                        <div class="layui-input-block">
                          <input type="text" id="studentEmail" placeholder="请输入邮箱" lay-verify="required|email" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <div class="layui-input-block">
                          <button class="layui-btn" lay-submit="" lay-filter="change" id="submit">立即提交</button>
                          <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script src="../assets/layui.all.js"></script>
    <script src="/js/jquery-3.3.1.min.js"></script>
    <script>
      $.ajax({
          type: "POST",
          url: "/back/user/getUserInfo",
          dataType: "json",
          contentType: "application/json;charset=utf-8",
          data: JSON.stringify({userType:"student"}),
          success: function(data){
              $("#collegeName").html(data.data.college);
              $("#clazzName").html(data.data.major);
              $("#clazzNumber").html(data.data.clazz);
              $("#studentNumber").html(data.data.number);
              $("#studentName").html(data.data.name);
              $("#studentSex").html(data.data.sex);
              $("#studentTel").val(data.data.tel);
              $("#studentEmail").val(data.data.email);
          },
          error:function(e){
              console.log(e);
          }
      });

      layui.use(['form','layer'], function(){
          layui.form.on('submit(change)', function(dataForm){
              $.ajax({
                  type: "POST",
                  url: "/back/user/udateTelEmail",
                  dataType: "json",
                  contentType: "application/json;charset=utf-8",
                  data: JSON.stringify({userType:"student",tel:$('#studentTel').val(),email:$('#studentEmail').val()}),
                  success: function(data){
                      if (data.data.state=='no') {
                        layui.layer.alert('<span style="color: #FF0000; font-size:16px;">'+data.data.msg+'</span>',{icon:2});
                      } else {
                        layui.layer.alert('<span style="font-size:16px;">'+data.data.msg+'</span>',{icon:1},function(){
                          window.location.href = window.location.href;
                        });
                        setTimeout(function () {
                            window.location.href = window.location.href;
                        }, 2000);
                      }
                  },
                  error:function(e){
                      console.log(e);
                  }
              });
              return false;
          });
      });
    </script>
</body>
</html>